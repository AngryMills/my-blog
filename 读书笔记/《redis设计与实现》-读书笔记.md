# 《redis 设计与实现》读书笔记

大家好，我是烤鸭：
&nbsp;&nbsp;&nbsp;&nbsp;《redis 设计与实现》，读书笔记。

##  第一部分 数据结构与对象

### 第2章 简单动态字符串

Redis 使用SDS 作为字符串表示。

O(1) 复杂度获取字符串长度。

杜绝缓冲区溢出。

减少修改字符串长度时所需的内存重分配次数。

二进制安全。

兼容部分C字符串函数。

### 第3章 链表

每个链表节点由一个listNode结构标识，每个节点都有一个指向前置接点和后置节点的指针，实现是双端链表。

每个链表用list结构标识，结构带有表头节点指针、表尾节点指针，链表长度等。

### 第4章 字典

Redis中的字典使用哈希表作为底层实现，每个字典表有两个哈希表，一个平时使用，另一个仅在进行rehash时使用。

哈希表使用链地址法来解决键冲突，被分配到同一个索引上的多个键值对会连接成一个单向链表。

对哈希表进行扩展或者收缩操作时，程序需要现有哈希表包含的现有键值对rehash到新哈希表里面，rehash过程是渐进式的。

dict中的rehashidx( -1 表示不在进行rehash)

rehash的index = hash & ht[0].size - 1

哈希表扩展操作的条件：

- 没有执行BGSAVE或者BGREWRITEAOF命令，哈希表的负载因子大于等于1。
- 服务器目前正在执行BGSAVE命令或者BGREWRITEAOF命令，并且哈希表的负载因子(ht[0].used/ht[0].size)大于等于5。

### 第5章 跳跃表

